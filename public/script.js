const apiKey="ce74a593068c612e5bc8451997f2fb81";let locationArr=[];localStorage.getItem("myWeatherLocationArr")?locationArr=JSON.parse(localStorage.getItem("myWeatherLocationArr")):localStorage.setItem("myWeatherLocationArr",JSON.stringify(locationArr));const locationSettingsTemplate=document.querySelector("#settings-location-item"),locationList=document.querySelector("#location-list");function createLocationList(){document.querySelector("#location-list").innerHTML="";for(let i=0;i<locationArr.length;i++){var locationSettingsItem=locationSettingsTemplate.cloneNode(!0).content.querySelector("li");locationSettingsItem.querySelector(".location-name").innerText=`${locationArr[i].name} (${locationArr[i].country})`,locationSettingsItem.setAttribute("data-location-lat",locationArr[i].lat),locationSettingsItem.setAttribute("data-location-lon",locationArr[i].lon),locationList.appendChild(locationSettingsItem),locationSettingsItem.querySelector("button").addEventListener("click",function(e){e.currentTarget.parentNode.remove(),locationArr.splice(locationArr.indexOf(locationArr[i]))})}}createLocationList();let dragSrcEl=null,dragSrcLat=0,dragSrcLon=0,dragSrcIndex,dropSrcIndex;function handleDragStart(e){this.style.opacity="0.4",dragSrcEl=e.currentTarget,dragSrcLat=e.currentTarget.getAttribute("data-location-lat"),dragSrcLon=e.currentTarget.getAttribute("data-location-lon");for(let i=0;i<locationArr.length;i++)locationArr[i].lat==dragSrcLat&&locationArr[i].lon==dragSrcLon&&(dragSrcIndex=i);e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",dragSrcEl.innerHTML)}function handleDragOver(e){e.preventDefault(),e.currentTarget.style.opacity=".4"}function handleDragEnter(e){e.preventDefault(),e.currentTarget.style.opacity=".4"}function handleDragLeave(e){e.currentTarget.style.opacity="1"}function handleDrop(e){e.preventDefault(),e.currentTarget.style.opacity="1";for(let i=0;i<locationArr.length;i++)locationArr[i].lat==this.getAttribute("data-location-lat")&&locationArr[i].lon==this.getAttribute("data-location-lon")&&(dropSrcIndex=i);dragSrcEl!=this&&(dragSrcEl.innerHTML=this.innerHTML,dragSrcEl.setAttribute("data-location-lat",this.getAttribute("data-location-lat")),dragSrcEl.setAttribute("data-location-lon",this.getAttribute("data-location-lon")),this.innerHTML=e.dataTransfer.getData("text/html"),this.setAttribute("data-location-lat",dragSrcLat),this.setAttribute("data-location-lon",dragSrcLon));var e=locationArr[dragSrcIndex],locationItemCopy2=locationArr[dropSrcIndex];return locationArr[dragSrcIndex]=locationItemCopy2,locationArr[dropSrcIndex]=e,!1}function handleDragEnd(e){this.style.opacity="1"}let items=document.querySelectorAll("#location-list li[draggable=true]");function getGeoLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(geolocationSuccess,geolocationError):(triggerToast("Error","Geolocation not supported","error"),0<locationArr.length&&getData(locationArr))}function geolocationError(){triggerToast("Error","Geolocation not found","error"),0<locationArr.length&&getData(locationArr)}function geolocationSuccess(position){fetch("https://api.openweathermap.org/geo/1.0/reverse?lat="+position.coords.latitude+"&lon="+position.coords.longitude+"&limit=1&appid="+apiKey).then(response=>response.json()).then(locationData=>{locationData.cod?triggerToast("Error",locationData.message,"error"):(JSON.stringify(locationArr).includes(locationData[0].lat)||JSON.stringify(locationArr).includes(locationData[0].lon)||(locationData[0].name="üìç "+locationData[0].name,getData(locationData)),setTimeout(function(){0<locationArr.length&&getData(locationArr)},500))})}items.forEach(function(item){item.addEventListener("dragstart",handleDragStart,!1),item.addEventListener("dragenter",handleDragEnter,!1),item.addEventListener("dragover",handleDragOver,!1),item.addEventListener("dragleave",handleDragLeave,!1),item.addEventListener("drop",handleDrop,!1),item.addEventListener("dragend",handleDragEnd,!1)}),getGeoLocation();const searchForm=document.querySelector("form#search-form"),locationSearchResults=document.querySelector("ul#location-search-reults"),locationSearchItem=document.querySelector("template#add-location-item").content.querySelector("li"),searchInput=document.querySelector("input#search"),dialogButtons=(searchForm.addEventListener("submit",function(e){e.preventDefault(),fetch("https://api.openweathermap.org/geo/1.0/direct?q="+searchInput.value+"&limit=5&appid="+apiKey).then(response=>response.json()).then(locationData=>{if(locationData.cod)triggerToast("Error",locationData.message,"error");else if(locationSearchResults.innerHTML="",0===locationData.length)triggerToast("Error","Location not found.","error");else for(let i=0;i<locationData.length;i++){var locationSearchItemClone=locationSearchItem.cloneNode(!0);locationSearchItemClone.setAttribute("data-location",locationData[i].name),locationSearchItemClone.querySelector("dt").innerText=""+locationData[i].name,locationSearchItemClone.querySelector("dd").innerText=locationData[i].state?`(${locationData[i].country} | ${locationData[i].state})`:`(${locationData[i].country})`,locationSearchResults.appendChild(locationSearchItemClone),locationSearchItemClone.addEventListener("click",function(){locationArr.includes(locationData[i])?triggerToast("Error","Location already exists.","error"):(locationArr.push(locationData[i]),createLocationList(),triggerToast("Info","Location added.","info"))})}})}),document.querySelectorAll("button[data-dialog-target]")),dialogs=document.querySelectorAll(".dialog");function closeDialog(e){dialogs.forEach(dialog=>dialog.classList.remove("open")),document.querySelector("body").style.overflow="auto",JSON.stringify(locationArr)!==localStorage.getItem("myWeatherLocationArr")&&(localStorage.setItem("myWeatherLocationArr",JSON.stringify(locationArr)),document.querySelector("main").innerHTML="",getGeoLocation())}dialogButtons.forEach(button=>{button.addEventListener("click",function(e){document.getElementById(e.currentTarget.getAttribute("data-dialog-target")).classList.add("open"),document.querySelector("body").style.overflow="hidden"})});let weatherLocationName;function getData(locationArr,counter=0){fetch("https://api.openweathermap.org/data/2.5/onecall?lat="+locationArr[counter].lat+"&lon="+locationArr[counter].lon+"&appid="+apiKey+"&units=metric&exclude=minutely").then(response=>response.json()).then(weatherData=>{weatherData.cod?triggerToast("Error",weatherData.message,"error"):(weatherLocationName=locationArr[counter].name,setWeatherData(weatherData),counter<locationArr.length-1?getData(locationArr,++counter):counter=0)})}function setWeatherData(weatherData){var weatherTemplateClone=document.querySelector("#weather-template").cloneNode(!0);weatherTemplateClone.content.querySelector(".weather-location").innerText=weatherLocationName,weatherTemplateClone.content.querySelector(".current-weather-video > video").setAttribute("src","vid/"+setWeatherMedia(weatherData.current.weather[0],"mp4")+".mp4");weatherTemplateClone.content.querySelector(".current-weather-icon").setAttribute("src","images/icons/"+setWeatherMedia(weatherData.current.weather[0],"svg")+".svg");var currentTemperature=weatherTemplateClone.content.querySelector(".current-temperature-value"),currentTemperature=(currentTemperature.innerText=Math.round(weatherData.current.temp),currentTemperature.parentNode.setAttribute("onclick",'triggerToast("Now", "'+weatherData.current.weather[0].description+" | "+Math.round(weatherData.current.temp)+'¬∞")'),getDay(weatherData.current.dt,weatherData.timezone_offset)),currentDateValue=getDate(weatherData.current.dt,weatherData.timezone_offset),currentTimeValue=getHoursAndMinutes(weatherData.current.dt,weatherData.timezone_offset),currentTemperature=(weatherTemplateClone.content.querySelector(".current-time").innerText=currentTemperature+`, ${currentDateValue} - `+currentTimeValue,weatherTemplateClone.content.querySelector(".sun-moon"));currentTemperature.addEventListener("click",function(e){e.currentTarget.classList.toggle("flipped")});weatherTemplateClone.content.querySelector(".current-sunrise-value").innerText=getHoursAndMinutes(weatherData.current.sunrise,weatherData.timezone_offset);currentDateValue=mapPercentageValue(weatherData.current.sunrise,weatherData.current.sunset,weatherData.current.dt),currentTimeValue=weatherTemplateClone.content.querySelector(".current-sunposition-indicator");currentTimeValue.style.left=currentDateValue+"%",currentTimeValue.style.opacity=0===currentDateValue?0:1,weatherTemplateClone.content.querySelector(".current-sunposition-progress").style.width=currentDateValue+"%",weatherTemplateClone.content.querySelector(".current-sunset-value").innerText=getHoursAndMinutes(weatherData.current.sunset,weatherData.timezone_offset);weatherTemplateClone.content.querySelector(".current-moonrise-value").innerText=getHoursAndMinutes(weatherData.daily[0].moonset,weatherData.timezone_offset);var currentTimeValue=mapPercentageValue(weatherData.daily[0].moonrise,weatherData.daily[0].moonset,weatherData.current.dt),currentMoonpositionIndicator=weatherTemplateClone.content.querySelector(".current-moonposition-indicator");currentMoonpositionIndicator.style.left=currentTimeValue+"%",currentMoonpositionIndicator.style.opacity=0===currentTimeValue?0:1,weatherTemplateClone.content.querySelector(".current-moonposition-progress").style.width=currentTimeValue+"%";weatherTemplateClone.content.querySelector(".current-moonset-value").innerText=getHoursAndMinutes(weatherData.daily[0].moonrise,weatherData.timezone_offset),0===currentDateValue&&0!==currentTimeValue&&currentTemperature.classList.add("flipped"),weatherTemplateClone.content.querySelector("#needle").style.transform="rotate("+weatherData.current.wind_deg+"deg)";var currentMoonpositionIndicator=weatherTemplateClone.content.querySelector(".current-wind-direction-value"),currentDateValue=(currentMoonpositionIndicator.innerText=setWindDirection(weatherData.current.wind_deg,!1),currentMoonpositionIndicator.parentNode.setAttribute("onclick",'triggerToast("Winddirection", "'+setWindDirection(weatherData.current.wind_deg,!1)+" | "+setWindDirection(weatherData.current.wind_deg,!0)+'")'),weatherTemplateClone.content.querySelector(".current-wind-speed-value")),currentTimeValue=(currentDateValue.innerText=Math.round(3.6*weatherData.current.wind_speed),currentDateValue.parentNode.setAttribute("onclick",'triggerToast("Windspeed", "'+Math.round(3.6*weatherData.current.wind_speed)+' km/h")'),weatherTemplateClone.content.querySelector(".current-pressure-value")),currentTemperature=(currentTimeValue.innerText=weatherData.current.pressure,currentTimeValue.parentNode.setAttribute("onclick",'triggerToast("Pressure", "'+weatherData.current.pressure+' hPa")'),weatherTemplateClone.content.querySelector(".current-humidity-value")),currentMoonpositionIndicator=(currentTemperature.innerText=weatherData.current.humidity,currentTemperature.parentNode.setAttribute("onclick",'triggerToast("Humidity", "'+weatherData.current.humidity+' %")'),weatherTemplateClone.content.querySelector(".current-pop-value")),currentTimeValue=(currentMoonpositionIndicator.innerText=Math.round(100*weatherData.hourly[0].pop),weatherData.hourly[0].rain?(currentDateValue=1e6*weatherData.hourly[0].rain["1h"]/1e6,currentMoonpositionIndicator.parentNode.setAttribute("onclick",'triggerToast("Rain", "'+Math.round(100*weatherData.hourly[0].pop)+" % | "+currentDateValue+' l/m¬≤")')):weatherData.hourly[0].snow?currentMoonpositionIndicator.parentNode.setAttribute("onclick",'triggerToast("Snow", "'+Math.round(100*weatherData.hourly[0].pop)+" % | "+weatherData.hourly[0].snow["1h"]+' mm")'):currentMoonpositionIndicator.parentNode.setAttribute("onclick",'triggerToast("Probability of precipitation", "'+Math.round(100*weatherData.hourly[0].pop)+' %")'),weatherTemplateClone.content.querySelector(".current-uvindex-value")),hourlyWeatherList=(currentTimeValue.innerText=weatherData.current.uvi,currentTimeValue.parentNode.setAttribute("onclick",'triggerToast("UV Index", "'+weatherData.current.uvi+'")'),weatherTemplateClone.content.querySelector(".hourly-weather-list"));for(let i=1;i<25;i++){var hourlyWeatherItemClone=weatherTemplateClone.content.querySelector(".hourly-weather-item").cloneNode(!0);hourlyWeatherItemClone.querySelector(".hourly-weather-item img").setAttribute("src","images/icons/"+setWeatherMedia(weatherData.hourly[i].weather[0],"svg")+".svg"),hourlyWeatherItemClone.querySelector(".hourly-temperature").innerText=Math.round(weatherData.hourly[i].temp);hourlyWeatherItemClone.querySelector(".hourly-timestamp").innerText=getHoursAndMinutes(weatherData.hourly[i].dt,weatherData.timezone_offset);var toastTitle=getHoursAndMinutes(weatherData.hourly[i].dt,weatherData.timezone_offset),toastDescription=weatherData.hourly[i].weather[0].description+" | "+Math.round(weatherData.hourly[i].temp)+"¬∞";hourlyWeatherItemClone.setAttribute("onclick",'triggerToast("'+toastTitle+'", "'+toastDescription+'")'),hourlyWeatherList.appendChild(hourlyWeatherItemClone,!0)}var dailyWeatherList=weatherTemplateClone.content.querySelector(".daily-weather-list");for(let i=1;i<8;i++){var dailyWeatherItemClone=weatherTemplateClone.content.querySelector(".daily-weather-item").cloneNode(!0),dailyDay=dailyWeatherItemClone.querySelector(".daily-day"),dailyDate=dailyWeatherItemClone.querySelector(".daily-date");dailyDay.innerText=getDay(weatherData.daily[i].dt,weatherData.timezone_offset),dailyDate.innerText=getDate(weatherData.daily[i].dt,weatherData.timezone_offset),dailyWeatherItemClone.querySelector(".daily-weather-item img").setAttribute("src","images/icons/"+setWeatherMedia(weatherData.daily[i].weather[0],"svg")+".svg"),dailyWeatherItemClone.querySelector(".daily-temperature").innerText=Math.round(weatherData.daily[i].temp.day),dailyWeatherItemClone.querySelector(".daily-temperature-max").innerText=Math.round(weatherData.daily[i].temp.max),dailyWeatherItemClone.querySelector(".daily-temperature-min").innerText=Math.round(weatherData.daily[i].temp.min),dailyWeatherItemClone.querySelector(".daily-pop").innerText=Math.round(100*weatherData.daily[i].pop)+" %",dailyWeatherItemClone.querySelector(".daily-wind").innerText=Math.round(3.6*weatherData.daily[i].wind_speed)+" km/h";let toastTitle=getDay(weatherData.daily[i].dt,weatherData.timezone_offset),toastDescription=weatherData.daily[i].weather[0].description+" | "+Math.round(weatherData.daily[i].temp.day)+"¬∞";dailyWeatherItemClone.setAttribute("onclick",'triggerToast("'+toastTitle+'", "'+toastDescription+'")'),dailyWeatherList.appendChild(dailyWeatherItemClone,!0)}weatherData.alerts&&((currentTemperature=document.querySelector("#alert-template").cloneNode(!0)).content.querySelector(".alert-value").innerText=weatherData.alerts[0].event,weatherTemplateClone.content.querySelector("section.current-weather").insertBefore(currentTemperature.content.querySelector(".weather-alert"),weatherTemplateClone.content.querySelector(".current-weather-data"))),document.querySelector("main").appendChild(weatherTemplateClone.content.querySelector("article"),!0)}function triggerToast(title,description,type="info"){var toastTemplateClone=document.querySelector("#toast-template").cloneNode(!0).content.querySelector(".toast");"info"===type?(toastTemplateClone.classList.add("info"),toastTemplateClone.querySelector("dl dt").innerHTML='<img src="images/icons/info.svg" height="24" width="24" alt="Info icon" /> '+title):"warning"===type?(toastTemplateClone.classList.add("warning"),toastTemplateClone.querySelector("dl dt").innerHTML='<img src="images/icons/warning.svg" height="24" width="24" alt="Warning icon" /> '+title):"error"===type?(toastTemplateClone.classList.add("error"),toastTemplateClone.querySelector("dl dt").innerHTML='<img src="images/icons/error.svg" height="24" width="24" alt="Error icon" /> '+title):toastTemplateClone.querySelector(".toast dl dt").innerText=title,toastTemplateClone.querySelector("dl dd").innerText=description,document.querySelector("body").appendChild(toastTemplateClone,!0),setTimeout(function(){document.querySelector(".toast").remove()},3500)}function getHoursAndMinutes(timestamp,offset){timestamp=new Date(1e3*(timestamp+offset));return hours=timestamp.getUTCHours()<10?"0"+timestamp.getUTCHours():timestamp.getUTCHours(),mins=timestamp.getUTCMinutes()<10?"0"+timestamp.getUTCMinutes():timestamp.getUTCMinutes(),hours+":"+mins}function getDate(timestamp,offset){timestamp=new Date(1e3*(timestamp+offset));day=timestamp.getUTCDate()<10?"0"+timestamp.getUTCDate():timestamp.getUTCDate();offset=(offset=timestamp.getUTCMonth()+1)<10?"0"+offset:offset;return day+"."+offset+"."}function getDay(timestamp,offset){timestamp=new Date(1e3*(timestamp+offset));switch(day=timestamp.getUTCDay()){case 1:return"Mon.";case 2:return"Tue.";case 3:return"Wed.";case 4:return"Thu.";case 5:return"Fri.";case 6:return"Sat.";case 0:return"Sun."}}function mapPercentageValue(min,max,value){return value<=max&&min<=value?Math.round(100/(max-min)*(value-min)):0}function setWeatherMedia(weather,filetype){if("mp4"===filetype){let videoName="";return"01d"===weather.icon&&(videoName="clear-sky-day"),"01n"===weather.icon&&(videoName="clear-sky-night"),"02d"===weather.icon&&(videoName="few-clouds-day"),"02n"===weather.icon&&(videoName="few-clouds-night"),"03d"!==weather.icon&&"03n"!==weather.icon||(videoName="cloud"),"04d"!==weather.icon&&"04n"!==weather.icon||(videoName="clouds"),"09d"!==weather.icon&&"09n"!==weather.icon&&"10d"!==weather.icon&&"10n"!==weather.icon||(videoName="rain"),"11d"!==weather.icon&&"11n"!==weather.icon||(videoName="thunderstorm"),"13d"!==weather.icon&&"13n"!==weather.icon||(videoName="snow"),videoName="50d"!==weather.icon&&"50n"!==weather.icon?videoName:"mist"}if("svg"===filetype){let iconName="";return["01d","01n","02d","02n"].includes(weather.icon)?("01d"===weather.icon&&(iconName="clear-sky-day"),"01n"===weather.icon&&(iconName="clear-sky-night"),"02d"===weather.icon&&(iconName="few-clouds-day"),"02n"===weather.icon&&(iconName="few-clouds-night")):([200,201,202,210,211,212,221,230,231,232].includes(weather.id)&&(iconName="thunderstorm"),[300,301,302,310,311,312,313,314,221].includes(weather.id)&&(iconName="drizzle"),[500,501].includes(weather.id)&&(iconName="light-rain"),[502,503,504,520,521,522,531].includes(weather.id)&&(iconName="light-rain"),[511,615,616].includes(weather.id)&&(iconName="snow-rain"),[600,612,620].includes(weather.id)&&(iconName="light-snow"),[601,613,621].includes(weather.id)&&(iconName="snow"),[602,611,622].includes(weather.id)&&(iconName="heavy-snow"),[701,721,741].includes(weather.id)&&(iconName="fog"),[711,731,751,761,762].includes(weather.id)&&(iconName="smoke"),[771].includes(weather.id)&&(iconName="wind"),[781].includes(weather.id)&&(iconName="tornado"),802===weather.id&&(iconName="cloud"),[803,804].includes(weather.id)&&(iconName="clouds")),iconName}}function setWindDirection(degrees,deg){var step=11.25;return-11.25<=degrees&&degrees<step||348.75<=degrees?deg?degrees+"¬∞":"N":11.25<degrees&&degrees<33.75?deg?degrees+"¬∞":"NNE":33.75<degrees&&degrees<56.25?deg?degrees+"¬∞":"NE":56.25<degrees&&degrees<78.75?deg?degrees+"¬∞":"ENE":78.75<degrees&&degrees<101.25?deg?degrees+"¬∞":"E":101.25<degrees&&degrees<123.75?deg?degrees+"¬∞":"ESE":123.75<degrees&&degrees<146.25?deg?degrees+"¬∞":"SE":146.25<degrees&&degrees<168.75?deg?degrees+"¬∞":"SSE":168.75<degrees&&degrees<191.25?deg?degrees+"¬∞":"S":191.25<degrees&&degrees<213.75?deg?degrees+"¬∞":"SSW":213.75<degrees&&degrees<236.25?deg?degrees+"¬∞":"SW":236.25<degrees&&degrees<258.75?deg?degrees+"¬∞":"WSW":258.75<degrees&&degrees<281.25?deg?degrees+"¬∞":"W":281.25<degrees&&degrees<303.75?deg?degrees+"¬∞":"WNW":303.75<degrees&&degrees<326.25?deg?degrees+"¬∞":"NW":326.25<degrees&&degrees<=348.75?deg?degrees+"¬∞":"NNW":void 0}